<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Phaser - Making your first game, part 1</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1280, 720, Phaser.AUTO, '', { preload: preload, create: create, update: update });
//Game is called outside of the functions and thus global, so can be called in EVERY function//

function preload() {
    game.load.image('sky', 'assets/sky.png');
    game.load.image('ground', 'assets/platform.png');
    game.load.image('star', 'assets/star.png');
    game.load.spritesheet('person', 'assets/dude.png', 32, 48);
}

var player; //Why define here? b/c these variables will be called in multiple functions!//
var platforms;
var cursors;
var stars;
var score = 0;
var scoreText;



function create() {

    //  We're going to be using physics, so enable the Arcade Physics system
    game.physics.startSystem(Phaser.Physics.ARCADE);/*global Phaser*/

    //  A simple background for our game
    var sky = game.add.sprite(0, 0, 'sky');//Animated backgrounds? Note: sprites can be scaled like objects in group can be, but only if you set a variable as the sprite first//

    sky.scale.setTo(2, 2);

    //  The platforms group contains the ground and the 2 ledges we can jump on
    platforms = game.add.group();

    //  We will enable physics for any object that is created in this group
    platforms.enableBody = true;//Makes the platforms have a 'body' so collisions happen//

    // Here we create the ground.
    var ground = platforms.create(0, game.world.height -64, 'ground');//Places ground at x,y of 0, (900 - 64), ground referring to platform that has been defined as ground//

    //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
    ground.scale.setTo(4, 2);//Increases scale by multiple of the numbers given (2x and 2y)//

    //  This stops it from falling away when you jump on it
    ground.body.immovable = true;//Meaning it has been set to physics type 'immovable' for its body, keeping it always at the coordinates given even if collided by other objects-specific to phaser, physics would make stuff float away on collision//

    //  Now let's create two ledges
    var ledge = platforms.create(400, 400, 'ground');//Create thing in platform group, set height and how far to the right//
    ledge.body.immovable = true;

    ledge = platforms.create(-150, 250, 'ground');//This does start the x value of the object off of the screen to the left (b/c 0 is the far left of the screen.)//
    ledge.body.immovable = true;

        // The player and its settings
    player = game.add.sprite(32, game.world.height - 150, 'person');

    //  We need to enable physics on the player
    game.physics.arcade.enable(player); //same kind of physics as on platform (don't want player to fall thru things and stuff)//

    //  Player physics properties. Give the little guy a slight bounce.
    player.body.bounce.y = 0.2; //how much player bounces when they hit the floor//
    player.body.gravity.y = 300; //higher number is like heavier gravity they will fall harder//
    player.body.collideWorldBounds = true;//means they don't run off of the ends of the screen on left right top or bottom or world if we had a bigger screen w/ a camera//

    //  Our two animations, walking left and right.
    player.animations.add('left', [0, 1, 2, 3], 10, true);//true means whether the animation loops or not in this case. the array of numbers is the frame order in the sprite sheet. this sprite sheet is 0->8 left to right//
    player.animations.add('right', [5, 6, 7, 8], 10, true);
    
    cursors = game.input.keyboard.createCursorKeys();//We created the cursors object, which means the player can be controlled with keyboard input.//

    //  Finally some stars to collect
    stars = game.add.group();

    //  We will enable physics for any star that is created in this group
    stars.enableBody = true;

    //  Here we'll create 12 of them evenly spaced apart
    for (var i = 0; i < 12; i++)//i++ means it adds one to the current value of i, but stops at 11 because it's less than 12 max as the cap value defined for i (meaning total 12 stars because 0-11)//
    {
        //  Create a star inside of the 'stars' group
        var star = stars.create(i * 70, 0, 'star');//Star is the individual item, stars is the name of the group containing them all. These are the coordinates of i btw-- i*70 --> i spaces each star at location, 70 pixels apart. In this kind of game the location is always the same when level is loaded, not programmatic. 0 is the y coordinate.//

        //  Let gravity do its thing
        star.body.gravity.y = 300;//Since the stars are affected by gravity, they fall in from the top of the screen

        //  This just gives each star a slightly random bounce value
        star.body.bounce.y = 0.7 + Math.random() * 0.2;//Then the stars bounce at random values-- this is the only thing that currently would change from load to load, not as noticeable as the map changing, etc.//
    }

    scoreText = game.add.text(16, 16, 'STARS: 0', { fontSize: '32px', fill: '#000' });//POINTS, x,y is 16,16, then default score and then size and hex color//
}

function update() {
    //  Collide the player and the stars with the platforms
    game.physics.arcade.collide(player, platforms);
    game.physics.arcade.collide(stars, platforms);//Also collides w/ platforms, meaning they do not sink into the ground//

      //  Reset the players velocity (movement)
    player.body.velocity.x = 0;//This means that when the character is receiving no input they have no velocity, ie, they are idle//

    if (cursors.left.isDown)//if the left motion key is being held down, then the following is true//
    {
        //  Move to the left
        player.body.velocity.x = -150;//Movin' left at the speed of 150, that's the player's max running speed; question for later how do we handle character accelerate to max? Danny: some people will make a constant elsewhere and call the constant to the game, ie player's max velocity is blah (the constant) so it can be changed as needed by editing only one source. In this case the velocity would not be -150 but would be the name of the variable for player velocity. This way it can change dynamically based on player input. (But like double tap to dash, etc? later)//

        player.animations.play('left');//<-- look! Animations! yaaay. But then so idle animations must be defined, every possible INPUT must have a corresponding ANIMATION or the animations would not play. //
    }
    else if (cursors.right.isDown)//Because of the way this code is written, for example, Crypt of the Necrodancer would be unviable b/c Left takes priority (IF first, THEN ElseIf, THEN Else) so functionality like pressing both keys at once would be fucked up//
    {
        //  Move to the right
        player.body.velocity.x = 150;//Basically, this works but it's the least efficient way to accomplish natural motion, unless moving left as a priority over right and not moving is like a gameplay mechanic-- hierarchical issues are not going to work with this.//

        player.animations.play('right');
    }
    else
    {
        //  Stand still
        player.animations.stop();//Their default here has no idle, but we could replace STOP with an idle animation. Animations are created in the CREATE function using sprite sheets but played in the UPDATE function-- this is specific to how Phaser does it.//

        player.frame = 4;//This sets which frame to go to when they are not animating (the look at camera frame for this example) so that they don't stop on whatever frame they were at.//
    }
    
    //  Allow the player to jump if they are touching the ground.
    if (cursors.up.isDown && player.body.touching.down)//Meaning that when the up key is pressed down AND the player is touching something-- player cannot jump on air, it won't work. If remove everything after the && then infinite jumping would be possible.//
    {
        player.body.velocity.y = -400;//Height of jump arc. negative means up and positive means down on the y axis. Number is magnitude of the jump.//
    }

    game.physics.arcade.overlap(player, stars, collectStar, null, this);

}

function collectStar (player, star) {
    
    // Removes the star from the screen
    star.kill();

    //  Add and update the score
    score += 10;
    scoreText.text = 'STARZ: ' + score;//Displays a string reading: [Text]: [Value of the score]//
}

</script>

</body>
</html>